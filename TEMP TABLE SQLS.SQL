CREATE DATABASE nhiss;
USE nhiss;

DROP TABLE IF EXISTS MCARE;
DROP TABLE IF EXISTS RAW_INST;
DROP TABLE IF EXISTS INST;
DROP TABLE IF EXISTS INST_R;
DROP TABLE IF EXISTS RAW_PT_BFC;
DROP TABLE IF EXISTS PT_BFC;
DROP TABLE IF EXISTS PT_R;

CREATE TABLE IF NOT EXISTS RAW_PT_BFC (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	STND_YM VARCHAR(16),
	PT_R_ID VARCHAR(16),
	SEX_TYPE VARCHAR(16),
	YEND_AGE_GRD VARCHAR(16),
	FMLY_CNT VARCHAR(16),
	GAIBJA_TYPE_CD VARCHAR(16),
	YEND_POTM_CTRB_20CLS VARCHAR(16),
	SB_INDTP_CD VARCHAR(16),
	DSB_YN VARCHAR(16),
	DSB_DGR VARCHAR(16)
);

LOAD DATA INFILE "e:\\datafiles\\PT_BFC_2011.tab" INTO TABLE RAW_PT_BFC IGNORE 1 LINES (STND_YM,PT_R_ID,SEX_TYPE,YEND_AGE_GRD,FMLY_CNT,GAIBJA_TYPE_CD,YEND_POTM_CTRB_20CLS,SB_INDTP_CD,DSB_YN,DSB_DGR);
LOAD DATA INFILE "e:\\datafiles\\PT_BFC_2012.tab" INTO TABLE RAW_PT_BFC IGNORE 1 LINES (STND_YM,PT_R_ID,SEX_TYPE,YEND_AGE_GRD,FMLY_CNT,GAIBJA_TYPE_CD,YEND_POTM_CTRB_20CLS,SB_INDTP_CD,DSB_YN,DSB_DGR);
LOAD DATA INFILE "e:\\datafiles\\PT_BFC_2013.tab" INTO TABLE RAW_PT_BFC IGNORE 1 LINES (STND_YM,PT_R_ID,SEX_TYPE,YEND_AGE_GRD,FMLY_CNT,GAIBJA_TYPE_CD,YEND_POTM_CTRB_20CLS,SB_INDTP_CD,DSB_YN,DSB_DGR);
LOAD DATA INFILE "e:\\datafiles\\PT_BFC_2014.tab" INTO TABLE RAW_PT_BFC IGNORE 1 LINES (STND_YM,PT_R_ID,SEX_TYPE,YEND_AGE_GRD,FMLY_CNT,GAIBJA_TYPE_CD,YEND_POTM_CTRB_20CLS,SB_INDTP_CD,DSB_YN,DSB_DGR);

CREATE TABLE IF NOT EXISTS PT_R (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	PT_R_ID VARCHAR(8) UNIQUE, 
	SEX_TYPE INTEGER,
	INDEX (PT_R_ID)
) AS
SELECT DISTINCT PT_R_ID, CAST(SEX_TYPE AS INTEGER) AS SEX_TYPE FROM RAW_PT_BFC;

UPDATE RAW_PT_BFC SET FMLY_CNT = '-1' WHERE FMLY_CNT = '';
UPDATE RAW_PT_BFC SET YEND_POTM_CTRB_20CLS='-1' WHERE YEND_POTM_CTRB_20CLS='';
UPDATE RAW_PT_BFC SET SB_INDTP_CD='-1' WHERE SB_INDTP_CD='';
UPDATE RAW_PT_BFC SET DSB_DGR='-1' WHERE LENGTH(DSB_DGR)=1;
UPDATE RAW_PT_BFC SET DSB_DGR='1' WHERE DSB_DGR=CONCAT('1', CHAR(13));
UPDATE RAW_PT_BFC SET DSB_DGR='2' WHERE DSB_DGR=CONCAT('2', CHAR(13));

CREATE TABLE IF NOT EXISTS PT_BFC (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	STND_Y INTEGER,
	PT_R_ID VARCHAR(8),
	YEND_AGE_GRD_N INTEGER,
	FMLY_CNT INTEGER,
	GAIBJA_TYPE_CD INTEGER,
	YEND_POTM_CTRB_20CLS INTEGER,
	SB_INDTP_CD INTEGER,
	DSB_YN INTEGER,
	DSB_DGR INTEGER,
	FOREIGN KEY (PT_R_ID) REFERENCES PT_R (PT_R_ID),
	UNIQUE KEY (STND_Y, PT_R_ID)
) AS
SELECT CAST(LEFT(STND_YM, 4) AS INTEGER) AS STND_Y, 
		PT_R_ID, 
		CAST(RIGHT(YEND_AGE_GRD, 2) AS INTEGER) AS YEND_AGE_GRD_N, 
		CAST(FMLY_CNT AS INTEGER) AS FMLY_CNT, 
		CAST(GAIBJA_TYPE_CD AS INTEGER) AS GAIBJA_TYPE_CD, 
		CAST(YEND_POTM_CTRB_20CLS AS INTEGER) AS YEND_POTM_CTRB_20CLS, 
		CAST(SB_INDTP_CD AS INTEGER) AS SB_INDTP_CD, 
		CAST(DSB_YN AS INTEGER) AS DSB_YN, 
		CAST(DSB_DGR AS INTEGER) AS DSB_DGR FROM RAW_PT_BFC;

CREATE TABLE IF NOT EXISTS RAW_INST (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	INST_ADPT_YYYYMM VARCHAR(16),
	INST_R_ID VARCHAR(16),
	INST_CLSF VARCHAR(16),
	FDAT_TYPE_CD VARCHAR(16),
	DISP_SUBJ_CD VARCHAR(16),
	CNT_MDR_TOT VARCHAR(16),
	CNT_MDR_SPC VARCHAR(16),
	CNT_DDR_TOT VARCHAR(16),
	CNT_DDR_SPC VARCHAR(16),
	CNT_HDR_TOT VARCHAR(16),
	CNT_HDR_SPC VARCHAR(16),
	CNT_NRS_TOT VARCHAR(16),
	CNT_NRS_AID_TOT VARCHAR(16),
	CNT_PHRM_TOT VARCHAR(16),
	CNT_ROOM_TOT VARCHAR(16),
	CNT_BED_TOT VARCHAR(16),
	CNT_ROOM_INP VARCHAR(16),
	CNT_BED_INP VARCHAR(16),
	CNT_ROOM_OP VARCHAR(16),
	CNT_BED_OP VARCHAR(16),
	CNT_ROOM_ICU_ADLT VARCHAR(16),
	CNT_BED_ICU_ADLT VARCHAR(16),
	CNT_ROOM_NICU VARCHAR(16),
	CNT_BED_NICU VARCHAR(16)
);

LOAD DATA INFILE "e:\\datafiles\\INST_2011_ADJ.tab" INTO TABLE RAW_INST IGNORE 1 LINES (INST_ADPT_YYYYMM,INST_R_ID,INST_CLSF,FDAT_TYPE_CD,DISP_SUBJ_CD,CNT_MDR_TOT,CNT_MDR_SPC,CNT_DDR_TOT,CNT_DDR_SPC,CNT_HDR_TOT,CNT_HDR_SPC,CNT_NRS_TOT,CNT_NRS_AID_TOT,CNT_PHRM_TOT,CNT_ROOM_TOT,CNT_BED_TOT,CNT_ROOM_INP,CNT_BED_INP,CNT_ROOM_OP,CNT_BED_OP,CNT_ROOM_ICU_ADLT,CNT_BED_ICU_ADLT,CNT_ROOM_NICU,CNT_BED_NICU);
LOAD DATA INFILE "e:\\datafiles\\INST_2012_ADJ.tab" INTO TABLE RAW_INST IGNORE 1 LINES (INST_ADPT_YYYYMM,INST_R_ID,INST_CLSF,FDAT_TYPE_CD,DISP_SUBJ_CD,CNT_MDR_TOT,CNT_MDR_SPC,CNT_DDR_TOT,CNT_DDR_SPC,CNT_HDR_TOT,CNT_HDR_SPC,CNT_NRS_TOT,CNT_NRS_AID_TOT,CNT_PHRM_TOT,CNT_ROOM_TOT,CNT_BED_TOT,CNT_ROOM_INP,CNT_BED_INP,CNT_ROOM_OP,CNT_BED_OP,CNT_ROOM_ICU_ADLT,CNT_BED_ICU_ADLT,CNT_ROOM_NICU,CNT_BED_NICU);
LOAD DATA INFILE "e:\\datafiles\\INST_2013_ADJ.tab" INTO TABLE RAW_INST IGNORE 1 LINES (INST_ADPT_YYYYMM,INST_R_ID,INST_CLSF,FDAT_TYPE_CD,DISP_SUBJ_CD,CNT_MDR_TOT,CNT_MDR_SPC,CNT_DDR_TOT,CNT_DDR_SPC,CNT_HDR_TOT,CNT_HDR_SPC,CNT_NRS_TOT,CNT_NRS_AID_TOT,CNT_PHRM_TOT,CNT_ROOM_TOT,CNT_BED_TOT,CNT_ROOM_INP,CNT_BED_INP,CNT_ROOM_OP,CNT_BED_OP,CNT_ROOM_ICU_ADLT,CNT_BED_ICU_ADLT,CNT_ROOM_NICU,CNT_BED_NICU);
LOAD DATA INFILE "e:\\datafiles\\INST_2014_ADJ.tab" INTO TABLE RAW_INST IGNORE 1 LINES (INST_ADPT_YYYYMM,INST_R_ID,INST_CLSF,FDAT_TYPE_CD,DISP_SUBJ_CD,CNT_MDR_TOT,CNT_MDR_SPC,CNT_DDR_TOT,CNT_DDR_SPC,CNT_HDR_TOT,CNT_HDR_SPC,CNT_NRS_TOT,CNT_NRS_AID_TOT,CNT_PHRM_TOT,CNT_ROOM_TOT,CNT_BED_TOT,CNT_ROOM_INP,CNT_BED_INP,CNT_ROOM_OP,CNT_BED_OP,CNT_ROOM_ICU_ADLT,CNT_BED_ICU_ADLT,CNT_ROOM_NICU,CNT_BED_NICU);

CREATE TABLE IF NOT EXISTS INST_R (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	INST_R_ID VARCHAR(10) UNIQUE, 
	INDEX (INST_R_ID)
) AS
SELECT DISTINCT INST_R_ID FROM RAW_INST;

UPDATE RAW_INST SET DISP_SUBJ_CD='-1' WHERE DISP_SUBJ_CD='';
UPDATE RAW_INST SET CNT_MDR_TOT='-1' WHERE CNT_MDR_TOT='';
UPDATE RAW_INST SET CNT_MDR_SPC='-1' WHERE CNT_MDR_SPC='';
UPDATE RAW_INST SET CNT_DDR_TOT='-1' WHERE CNT_DDR_TOT='';
UPDATE RAW_INST SET CNT_DDR_SPC='-1' WHERE CNT_DDR_SPC='';
UPDATE RAW_INST SET CNT_HDR_TOT='-1' WHERE CNT_HDR_TOT='';
UPDATE RAW_INST SET CNT_HDR_SPC='-1' WHERE CNT_HDR_SPC='';
UPDATE RAW_INST SET CNT_NRS_TOT='-1' WHERE CNT_NRS_TOT='';
UPDATE RAW_INST SET CNT_NRS_AID_TOT='-1' WHERE CNT_NRS_AID_TOT='';
UPDATE RAW_INST SET CNT_PHRM_TOT='-1' WHERE CNT_PHRM_TOT='';
UPDATE RAW_INST SET CNT_ROOM_TOT='-1' WHERE CNT_ROOM_TOT='';
UPDATE RAW_INST SET CNT_BED_TOT='-1' WHERE CNT_BED_TOT='';
UPDATE RAW_INST SET CNT_ROOM_INP='-1' WHERE CNT_ROOM_INP='';
UPDATE RAW_INST SET CNT_BED_INP='-1' WHERE CNT_BED_INP='';
UPDATE RAW_INST SET CNT_ROOM_OP='-1' WHERE CNT_ROOM_OP='';
UPDATE RAW_INST SET CNT_BED_OP='-1' WHERE CNT_BED_OP='';
UPDATE RAW_INST SET CNT_ROOM_ICU_ADLT='-1' WHERE CNT_ROOM_ICU_ADLT='';
UPDATE RAW_INST SET CNT_BED_ICU_ADLT='-1' WHERE CNT_BED_ICU_ADLT='';
UPDATE RAW_INST SET CNT_ROOM_NICU='-1' WHERE CNT_ROOM_NICU='';
UPDATE RAW_INST SET CNT_BED_NICU=LEFT(CNT_BED_NICU, LENGTH(CNT_BED_NICU)-1);
UPDATE RAW_INST SET CNT_BED_NICU='-1' WHERE CNT_BED_NICU='';

CREATE TABLE IF NOT EXISTS INST (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	INST_ADPT_YYYY INTEGER,
	INST_R_ID VARCHAR(10),
	INST_CLSF INTEGER,
	FDAT_TYPE_CD INTEGER,
	DISP_SUBJ_CD INTEGER,
	CNT_MDR_TOT INTEGER,
	CNT_MDR_SPC INTEGER,
	CNT_DDR_TOT INTEGER,
	CNT_DDR_SPC INTEGER,
	CNT_HDR_TOT INTEGER,
	CNT_HDR_SPC INTEGER,
	CNT_NRS_TOT INTEGER,
	CNT_NRS_AID_TOT INTEGER,
	CNT_PHRM_TOT INTEGER,
	CNT_ROOM_TOT INTEGER,
	CNT_BED_TOT INTEGER,
	CNT_ROOM_INP INTEGER,
	CNT_BED_INP INTEGER,
	CNT_ROOM_OP INTEGER,
	CNT_BED_OP INTEGER,
	CNT_ROOM_ICU_ADLT INTEGER,
	CNT_BED_ICU_ADLT INTEGER,
	CNT_ROOM_NICU INTEGER,
	CNT_BED_NICU INTEGER,
	FOREIGN KEY K1 (INST_R_ID) REFERENCES INST_R (INST_R_ID),
	UNIQUE KEY K2 (INST_ADPT_YYYY, INST_R_ID)
) AS
SELECT CAST(LEFT(INST_ADPT_YYYYMM, 4) AS INTEGER) AS INST_ADPT_YYYY,
		INST_R_ID,
		CAST(INST_CLSF AS INTEGER) AS INST_CLSF,
		CAST(FDAT_TYPE_CD AS INTEGER) AS FDAT_TYPE_CD,
		CAST(DISP_SUBJ_CD AS INTEGER) AS DISP_SUBJ_CD,
		CAST(CNT_MDR_TOT AS INTEGER) AS CNT_MDR_TOT,
		CAST(CNT_MDR_SPC AS INTEGER) AS CNT_MDR_SPC,
		CAST(CNT_DDR_TOT AS INTEGER) AS CNT_DDR_TOT,
		CAST(CNT_DDR_SPC AS INTEGER) AS CNT_DDR_SPC,
		CAST(CNT_HDR_TOT AS INTEGER) AS CNT_HDR_TOT,
		CAST(CNT_HDR_SPC AS INTEGER) AS CNT_HDR_SPC,
		CAST(CNT_NRS_TOT AS INTEGER) AS CNT_NRS_TOT,
		CAST(CNT_NRS_AID_TOT AS INTEGER) AS CNT_NRS_AID_TOT,
		CAST(CNT_PHRM_TOT AS INTEGER) AS CNT_PHRM_TOT,
		CAST(CNT_ROOM_TOT AS INTEGER) AS CNT_ROOM_TOT,
		CAST(CNT_BED_TOT AS INTEGER) AS CNT_BED_TOT,
		CAST(CNT_ROOM_INP AS INTEGER) AS CNT_ROOM_INP,
		CAST(CNT_BED_INP AS INTEGER) AS CNT_BED_INP,
		CAST(CNT_ROOM_OP AS INTEGER) AS CNT_ROOM_OP,
		CAST(CNT_BED_OP AS INTEGER) AS CNT_BED_OP,
		CAST(CNT_ROOM_ICU_ADLT AS INTEGER) AS CNT_ROOM_ICU_ADLT,
		CAST(CNT_BED_ICU_ADLT AS INTEGER) AS CNT_BED_ICU_ADLT,
		CAST(CNT_ROOM_NICU AS INTEGER) AS CNT_ROOM_NICU,
		CAST(CNT_BED_NICU AS INTEGER) AS CNT_BED_NICU 
		FROM RAW_INST;



CREATE TABLE IF NOT EXISTS RAW_MCARE (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	PT_R_ID VARCHAR(16),
	GRID100_PT VARCHAR(16),
	INST_R_ID VARCHAR(16),
	GRID100_INST VARCHAR(16),
	DIST VARCHAR(16),
	TIME VARCHAR(16),
	SUJIN_POTM_PT_ADDR_CD VARCHAR(16),
	SUJIN_POTM_PT_LOC_CD VARCHAR(16),
	SUJIN_POTM_INST_ADDR_CD VARCHAR(16),
	SUJIN_POTM_INST_LOC_CD VARCHAR(16),
	INST_CLSF VARCHAR(16),
	DISP_SUBJ_TYPE VARCHAR(16),
	MCARE_SUBJ_CD VARCHAR(16),
	SICK_SYM1 VARCHAR(16),
	MDCARE_STRT_DT VARCHAR(16),
	FORM_CD VARCHAR(16),
	VSHSP_DD_CNT VARCHAR(16),
	ED_RC_TOT_AMT VARCHAR(16),
	EDC_SBA VARCHAR(16),
	EDC_INSUR_BRDN_AMT VARCHAR(16)
);



LOAD DATA INFILE "e:\\datafiles\\MCARE_2012.tab" INTO TABLE RAW_MCARE IGNORE 1 LINES (PT_R_ID,GRID100_PT,INST_R_ID,GRID100_INST,DIST,TIME,SUJIN_POTM_PT_ADDR_CD,SUJIN_POTM_PT_LOC_CD,SUJIN_POTM_INST_ADDR_CD,SUJIN_POTM_INST_LOC_CD,INST_CLSF,DISP_SUBJ_TYPE,MCARE_SUBJ_CD,SICK_SYM1,MDCARE_STRT_DT,FORM_CD,VSHSP_DD_CNT,ED_RC_TOT_AMT,EDC_SBA,EDC_INSUR_BRDN_AMT);
LOAD DATA INFILE "e:\\datafiles\\MCARE_2013.tab" INTO TABLE RAW_MCARE IGNORE 1 LINES (PT_R_ID,GRID100_PT,INST_R_ID,GRID100_INST,DIST,TIME,SUJIN_POTM_PT_ADDR_CD,SUJIN_POTM_PT_LOC_CD,SUJIN_POTM_INST_ADDR_CD,SUJIN_POTM_INST_LOC_CD,INST_CLSF,DISP_SUBJ_TYPE,MCARE_SUBJ_CD,SICK_SYM1,MDCARE_STRT_DT,FORM_CD,VSHSP_DD_CNT,ED_RC_TOT_AMT,EDC_SBA,EDC_INSUR_BRDN_AMT);
LOAD DATA INFILE "e:\\datafiles\\MCARE_2014.tab" INTO TABLE RAW_MCARE IGNORE 1 LINES (PT_R_ID,GRID100_PT,INST_R_ID,GRID100_INST,DIST,TIME,SUJIN_POTM_PT_ADDR_CD,SUJIN_POTM_PT_LOC_CD,SUJIN_POTM_INST_ADDR_CD,SUJIN_POTM_INST_LOC_CD,INST_CLSF,DISP_SUBJ_TYPE,MCARE_SUBJ_CD,SICK_SYM1,MDCARE_STRT_DT,FORM_CD,VSHSP_DD_CNT,ED_RC_TOT_AMT,EDC_SBA,EDC_INSUR_BRDN_AMT);

SELECT INST_R_ID FROM RAW_MCARE WHERE INST_R_ID NOT IN (SELECT INST_R_ID FROM INST_R) LIMIT 5;


-- INSERT MISSING INST_R_IDs INTO INST_R TABLE
INSERT INTO INST_R (INST_R_ID) SELECT DISTINCT INST_R_ID FROM RAW_MCARE WHERE INST_R_ID NOT IN (SELECT INST_R_ID FROM INST_R);

UPDATE RAW_MCARE SET DISP_SUBJ_TYPE='-1' WHERE DISP_SUBJ_TYPE='ZZ' OR DISP_SUBJ_TYPE='z' OR DISP_SUBJ_TYPE='{' OR DISP_SUBJ_TYPE='}';
UPDATE RAW_MCARE SET EDC_INSUR_BRDN_AMT = LEFT(EDC_INSUR_BRDN_AMT, LENGTH(EDC_INSUR_BRDN_AMT)-1);

CREATE TABLE IF NOT EXISTS MCARE (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	PT_R_ID VARCHAR(8),
	GRID100_PT INTEGER,
	INST_R_ID VARCHAR(10),
	GRID100_INST INTEGER,
	DIST DOUBLE,
	TIME DOUBLE,
	SUJIN_POTM_PT_ADDR_CD INTEGER,
	SUJIN_POTM_PT_LOC_CD INTEGER,
	SUJIN_POTM_INST_ADDR_CD INTEGER,
	SUJIN_POTM_INST_LOC_CD INTEGER,
	INST_CLSF INTEGER,
	DISP_SUBJ_TYPE INTEGER,
	MCARE_SUBJ_CD INTEGER,
	SICK_SYM1 VARCHAR(6),
	MDCARE_STRT_YEAR INTEGER,
	MDCARE_STRT_MONTH INTEGER,
	MDCARE_STRT_DAY INTEGER,
	MDCARE_STRT_DT DATE,
	FORM_CD INTEGER,
	VSHSP_DD_CNT INTEGER,
	ED_RC_TOT_AMT INTEGER,
	EDC_SBA INTEGER,
	EDC_INSUR_BRDN_AMT INTEGER,
	INDEX (THE_ID),
	INDEX (PT_R_ID),
	INDEX (INST_R_ID),
	INDEX (PT_R_ID, INST_R_ID),
	FOREIGN KEY (PT_R_ID) REFERENCES PT_R (PT_R_ID),
	FOREIGN KEY (INST_R_ID) REFERENCES INST_R (INST_R_ID)
) AS
SELECT 
	PT_R_ID,
	CAST(GRID100_PT AS INTEGER) AS GRID100_PT,
	INST_R_ID,
	CAST(GRID100_INST AS INTEGER) AS GRID100_INST,
	CAST(DIST AS DOUBLE) AS DIST,
	CAST(TIME AS DOUBLE) AS TIME,
	CAST(SUJIN_POTM_PT_ADDR_CD AS INTEGER) AS SUJIN_POTM_PT_ADDR_CD,
	CAST(SUJIN_POTM_PT_LOC_CD AS INTEGER) AS SUJIN_POTM_PT_LOC_CD,
	CAST(SUJIN_POTM_INST_ADDR_CD AS INTEGER) AS SUJIN_POTM_INST_ADDR_CD,
	CAST(SUJIN_POTM_INST_LOC_CD AS INTEGER) AS SUJIN_POTM_INST_LOC_CD,
	CAST(INST_CLSF AS INTEGER) AS INST_CLSF,
	CAST(DISP_SUBJ_TYPE AS INTEGER) AS DISP_SUBJ_TYPE,
	CAST(MCARE_SUBJ_CD AS INTEGER) AS MCARE_SUBJ_CD,
	SICK_SYM1,
	CAST(LEFT(MDCARE_STRT_DT, 4) AS INTEGER) AS MDCARE_STRT_YEAR,
	CAST(MID(MDCARE_STRT_DT, 5, 2) AS INTEGER) AS MDCARE_STRT_MONTH,
	CAST(RIGHT(MDCARE_STRT_DT, 2) AS INTEGER) AS MDCARE_STRT_DAY,
	DATE(CONCAT(LEFT(MDCARE_STRT_DT, 4), '-', MID(MDCARE_STRT_DT, 5, 2), '-', RIGHT(MDCARE_STRT_DT, 2))) AS MDCARE_STRT_DT,
	CAST(FORM_CD AS INTEGER) AS FORM_CD,
	CAST(VSHSP_DD_CNT AS INTEGER) AS VSHSP_DD_CNT,
	CAST(ED_RC_TOT_AMT AS INTEGER) AS ED_RC_TOT_AMT,
	CAST(EDC_SBA AS INTEGER) AS EDC_SBA,
	CAST(EDC_INSUR_BRDN_AMT AS INTEGER) AS EDC_INSUR_BRDN_AMT
FROM RAW_MCARE;


-- CREATE TABLE INST_R_FROM_INST (INST_R_ID VARCHAR(16)) AS SELECT DISTINCT INST_R_ID FROM RAW_INST;
-- CREATE TABLE INST_R_FROM_MCARE (INST_R_ID VARCHAR(16)) AS SELECT DISTINCT INST_R_ID FROM RAW_MCARE;


SELECT * FROM PT_R INTO OUTFILE 'e:\\datafiles\\export\\PT_R.CSV' CHARACTER SET euckr FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' ESCAPED BY '\\' LINES TERMINATED BY '\n';
SELECT * FROM INST_R INTO OUTFILE 'e:\\datafiles\\export\\INST_R.CSV' CHARACTER SET euckr FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' ESCAPED BY '\\' LINES TERMINATED BY '\n';
SELECT * FROM PT_BFC INTO OUTFILE 'e:\\datafiles\\export\\PT_BFC.CSV' CHARACTER SET euckr FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' ESCAPED BY '\\' LINES TERMINATED BY '\n';
SELECT * FROM INST INTO OUTFILE 'e:\\datafiles\\export\\INST.CSV' CHARACTER SET euckr FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' ESCAPED BY '\\' LINES TERMINATED BY '\n';
SELECT * FROM MCARE INTO OUTFILE 'e:\\datafiles\\export\\MCARE.CSV' CHARACTER SET euckr FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' ESCAPED BY '\\' LINES TERMINATED BY '\n';



-- SCRIPT VERSION OF TABLE EXPORT WITH COLUMN NAMES
'PT_R'
'INST_R'
'PT_BFC'
'INST'
'MCARE'

SELECT 'MCARE' INTO @TABLENAME;
SELECT 'e:\\\\datafiles\\\\export\\\\' INTO @EXPORTPATH;

SELECT GROUP_CONCAT(CONCAT("'", COLUMN_NAME,"'")) INTO @COLUMNSTR1 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME=@TABLENAME;
SELECT GROUP_CONCAT(COLUMN_NAME) INTO @COLUMNSTR2 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME=@TABLENAME;

SET @QUERY1 = CONCAT("SELECT ", @COLUMNSTR1, " 
			UNION ALL 
		SELECT ", @COLUMNSTR2, " FROM ", @TABLENAME, " INTO OUTFILE '", @EXPORTPATH, @TABLENAME, ".CSV' CHARACTER SET euckr FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '\"';");

PREPARE STMT FROM @QUERY1;
EXECUTE STMT;

---- END OF THE SCRIPT

