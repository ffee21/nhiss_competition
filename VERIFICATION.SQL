CREATE DATABASE nhiss;
USE nhiss;

DROP TABLE IF EXISTS MCARE;
DROP TABLE IF EXISTS RAW_INST;
DROP TABLE IF EXISTS INST;
DROP TABLE IF EXISTS INST_R;
DROP TABLE IF EXISTS RAW_PT_BFC;
DROP TABLE IF EXISTS PT_BFC;
DROP TABLE IF EXISTS PT_R;

CREATE TABLE IF NOT EXISTS RAW_PT_BFC (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	STND_YM VARCHAR(16),
	PT_R_ID VARCHAR(16),
	SEX_TYPE VARCHAR(16),
	YEND_AGE_GRD VARCHAR(16),
	FMLY_CNT VARCHAR(16),
	GAIBJA_TYPE_CD VARCHAR(16),
	YEND_POTM_CTRB_20CLS VARCHAR(16),
	SB_INDTP_CD VARCHAR(16),
	DSB_YN VARCHAR(16),
	DSB_DGR VARCHAR(16)
);

LOAD DATA INFILE "e:\\datafiles\\PT_BFC_2011.tab" INTO TABLE RAW_PT_BFC IGNORE 1 LINES (STND_YM,PT_R_ID,SEX_TYPE,YEND_AGE_GRD,FMLY_CNT,GAIBJA_TYPE_CD,YEND_POTM_CTRB_20CLS,SB_INDTP_CD,DSB_YN,DSB_DGR);
LOAD DATA INFILE "e:\\datafiles\\PT_BFC_2012.tab" INTO TABLE RAW_PT_BFC IGNORE 1 LINES (STND_YM,PT_R_ID,SEX_TYPE,YEND_AGE_GRD,FMLY_CNT,GAIBJA_TYPE_CD,YEND_POTM_CTRB_20CLS,SB_INDTP_CD,DSB_YN,DSB_DGR);
LOAD DATA INFILE "e:\\datafiles\\PT_BFC_2013.tab" INTO TABLE RAW_PT_BFC IGNORE 1 LINES (STND_YM,PT_R_ID,SEX_TYPE,YEND_AGE_GRD,FMLY_CNT,GAIBJA_TYPE_CD,YEND_POTM_CTRB_20CLS,SB_INDTP_CD,DSB_YN,DSB_DGR);
LOAD DATA INFILE "e:\\datafiles\\PT_BFC_2014.tab" INTO TABLE RAW_PT_BFC IGNORE 1 LINES (STND_YM,PT_R_ID,SEX_TYPE,YEND_AGE_GRD,FMLY_CNT,GAIBJA_TYPE_CD,YEND_POTM_CTRB_20CLS,SB_INDTP_CD,DSB_YN,DSB_DGR);

CREATE TABLE IF NOT EXISTS PT_R (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	PT_R_ID VARCHAR(16) UNIQUE, 
	SEX_TYPE VARCHAR(16),
	INDEX (PT_R_ID)
) AS
SELECT DISTINCT PT_R_ID, SEX_TYPE FROM RAW_PT_BFC;

CREATE TABLE IF NOT EXISTS PT_BFC (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	STND_YM VARCHAR(16),
	PT_R_ID VARCHAR(16),
	YEND_AGE_GRD VARCHAR(16),
	FMLY_CNT VARCHAR(16),
	GAIBJA_TYPE_CD VARCHAR(16),
	YEND_POTM_CTRB_20CLS VARCHAR(16),
	SB_INDTP_CD VARCHAR(16),
	DSB_YN VARCHAR(16),
	DSB_DGR VARCHAR(16),
	FOREIGN KEY (PT_R_ID) REFERENCES PT_R (PT_R_ID),
	UNIQUE KEY (STND_YM, PT_R_ID)
) AS
SELECT STND_YM, PT_R_ID, YEND_AGE_GRD, FMLY_CNT, GAIBJA_TYPE_CD, YEND_POTM_CTRB_20CLS, SB_INDTP_CD, DSB_YN, DSB_DGR FROM RAW_PT_BFC;

CREATE TABLE IF NOT EXISTS RAW_INST (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	INST_ADPT_YYYYMM VARCHAR(16),
	INST_R_ID VARCHAR(16),
	INST_CLSF VARCHAR(16),
	FDAT_TYPE_CD VARCHAR(16),
	DISP_SUBJ_CD VARCHAR(16),
	CNT_MDR_TOT VARCHAR(16),
	CNT_MDR_SPC VARCHAR(16),
	CNT_DDR_TOT VARCHAR(16),
	CNT_DDR_SPC VARCHAR(16),
	CNT_HDR_TOT VARCHAR(16),
	CNT_HDR_SPC VARCHAR(16),
	CNT_NRS_TOT VARCHAR(16),
	CNT_NRS_AID_TOT VARCHAR(16),
	CNT_PHRM_TOT VARCHAR(16),
	CNT_ROOM_TOT VARCHAR(16),
	CNT_BED_TOT VARCHAR(16),
	CNT_ROOM_INP VARCHAR(16),
	CNT_BED_INP VARCHAR(16),
	CNT_ROOM_OP VARCHAR(16),
	CNT_BED_OP VARCHAR(16),
	CNT_ROOM_ICU_ADLT VARCHAR(16),
	CNT_BED_ICU_ADLT VARCHAR(16),
	CNT_ROOM_NICU VARCHAR(16),
	CNT_BED_NICU VARCHAR(16)
);

LOAD DATA INFILE "e:\\datafiles\\INST_2011_ADJ.tab" INTO TABLE RAW_INST IGNORE 1 LINES (INST_ADPT_YYYYMM,INST_R_ID,INST_CLSF,FDAT_TYPE_CD,DISP_SUBJ_CD,CNT_MDR_TOT,CNT_MDR_SPC,CNT_DDR_TOT,CNT_DDR_SPC,CNT_HDR_TOT,CNT_HDR_SPC,CNT_NRS_TOT,CNT_NRS_AID_TOT,CNT_PHRM_TOT,CNT_ROOM_TOT,CNT_BED_TOT,CNT_ROOM_INP,CNT_BED_INP,CNT_ROOM_OP,CNT_BED_OP,CNT_ROOM_ICU_ADLT,CNT_BED_ICU_ADLT,CNT_ROOM_NICU,CNT_BED_NICU);
LOAD DATA INFILE "e:\\datafiles\\INST_2012_ADJ.tab" INTO TABLE RAW_INST IGNORE 1 LINES (INST_ADPT_YYYYMM,INST_R_ID,INST_CLSF,FDAT_TYPE_CD,DISP_SUBJ_CD,CNT_MDR_TOT,CNT_MDR_SPC,CNT_DDR_TOT,CNT_DDR_SPC,CNT_HDR_TOT,CNT_HDR_SPC,CNT_NRS_TOT,CNT_NRS_AID_TOT,CNT_PHRM_TOT,CNT_ROOM_TOT,CNT_BED_TOT,CNT_ROOM_INP,CNT_BED_INP,CNT_ROOM_OP,CNT_BED_OP,CNT_ROOM_ICU_ADLT,CNT_BED_ICU_ADLT,CNT_ROOM_NICU,CNT_BED_NICU);
LOAD DATA INFILE "e:\\datafiles\\INST_2013_ADJ.tab" INTO TABLE RAW_INST IGNORE 1 LINES (INST_ADPT_YYYYMM,INST_R_ID,INST_CLSF,FDAT_TYPE_CD,DISP_SUBJ_CD,CNT_MDR_TOT,CNT_MDR_SPC,CNT_DDR_TOT,CNT_DDR_SPC,CNT_HDR_TOT,CNT_HDR_SPC,CNT_NRS_TOT,CNT_NRS_AID_TOT,CNT_PHRM_TOT,CNT_ROOM_TOT,CNT_BED_TOT,CNT_ROOM_INP,CNT_BED_INP,CNT_ROOM_OP,CNT_BED_OP,CNT_ROOM_ICU_ADLT,CNT_BED_ICU_ADLT,CNT_ROOM_NICU,CNT_BED_NICU);
LOAD DATA INFILE "e:\\datafiles\\INST_2014_ADJ.tab" INTO TABLE RAW_INST IGNORE 1 LINES (INST_ADPT_YYYYMM,INST_R_ID,INST_CLSF,FDAT_TYPE_CD,DISP_SUBJ_CD,CNT_MDR_TOT,CNT_MDR_SPC,CNT_DDR_TOT,CNT_DDR_SPC,CNT_HDR_TOT,CNT_HDR_SPC,CNT_NRS_TOT,CNT_NRS_AID_TOT,CNT_PHRM_TOT,CNT_ROOM_TOT,CNT_BED_TOT,CNT_ROOM_INP,CNT_BED_INP,CNT_ROOM_OP,CNT_BED_OP,CNT_ROOM_ICU_ADLT,CNT_BED_ICU_ADLT,CNT_ROOM_NICU,CNT_BED_NICU);

CREATE TABLE IF NOT EXISTS INST_R (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	INST_R_ID VARCHAR(16) UNIQUE, 
	INDEX (INST_R_ID)
) AS
SELECT DISTINCT INST_R_ID FROM RAW_INST;

CREATE TABLE IF NOT EXISTS INST (
	THE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	INST_ADPT_YYYYMM VARCHAR(16),
	INST_R_ID VARCHAR(16),
	INST_CLSF VARCHAR(16),
	FDAT_TYPE_CD VARCHAR(16),
	DISP_SUBJ_CD VARCHAR(16),
	CNT_MDR_TOT VARCHAR(16),
	CNT_MDR_SPC VARCHAR(16),
	CNT_DDR_TOT VARCHAR(16),
	CNT_DDR_SPC VARCHAR(16),
	CNT_HDR_TOT VARCHAR(16),
	CNT_HDR_SPC VARCHAR(16),
	CNT_NRS_TOT VARCHAR(16),
	CNT_NRS_AID_TOT VARCHAR(16),
	CNT_PHRM_TOT VARCHAR(16),
	CNT_ROOM_TOT VARCHAR(16),
	CNT_BED_TOT VARCHAR(16),
	CNT_ROOM_INP VARCHAR(16),
	CNT_BED_INP VARCHAR(16),
	CNT_ROOM_OP VARCHAR(16),
	CNT_BED_OP VARCHAR(16),
	CNT_ROOM_ICU_ADLT VARCHAR(16),
	CNT_BED_ICU_ADLT VARCHAR(16),
	CNT_ROOM_NICU VARCHAR(16),
	CNT_BED_NICU VARCHAR(16),
	FOREIGN KEY K1 (INST_R_ID) REFERENCES INST_R (INST_R_ID),
	UNIQUE KEY K2 (INST_ADPT_YYYYMM, INST_R_ID)
) AS
SELECT INST_ADPT_YYYYMM,INST_R_ID,INST_CLSF,FDAT_TYPE_CD,DISP_SUBJ_CD,CNT_MDR_TOT,CNT_MDR_SPC,CNT_DDR_TOT,CNT_DDR_SPC,CNT_HDR_TOT,CNT_HDR_SPC,CNT_NRS_TOT,CNT_NRS_AID_TOT,CNT_PHRM_TOT,CNT_ROOM_TOT,CNT_BED_TOT,CNT_ROOM_INP,CNT_BED_INP,CNT_ROOM_OP,CNT_BED_OP,CNT_ROOM_ICU_ADLT,CNT_BED_ICU_ADLT,CNT_ROOM_NICU,CNT_BED_NICU FROM RAW_INST;



CREATE TABLE IF NOT EXISTS RAW_MCARE (
	MCARE_ID INTEGER AUTO_INCREMENT PRIMARY KEY,
	PT_R_ID VARCHAR(16),
	GRID100_PT VARCHAR(16),
	INST_R_ID VARCHAR(16),
	GRID100_INST VARCHAR(16),
	DIST VARCHAR(16),
	TIME VARCHAR(16),
	SUJIN_POTM_PT_ADDR_CD VARCHAR(16),
	SUJIN_POTM_PT_LOC_CD VARCHAR(16),
	SUJIN_POTM_INST_ADDR_CD VARCHAR(16),
	SUJIN_POTM_INST_LOC_CD VARCHAR(16),
	INST_CLSF VARCHAR(16),
	DISP_SUBJ_TYPE VARCHAR(16),
	MCARE_SUBJ_CD VARCHAR(16),
	SICK_SYM1 VARCHAR(16),
	MDCARE_STRT_DT VARCHAR(16),
	FORM_CD VARCHAR(16),
	VSHSP_DD_CNT VARCHAR(16),
	ED_RC_TOT_AMT VARCHAR(16),
	EDC_SBA VARCHAR(16),
	EDC_INSUR_BRDN_AMT VARCHAR(16)
);



LOAD DATA INFILE "e:\\datafiles\\MCARE_2012.tab" INTO TABLE RAW_MCARE IGNORE 1 LINES (PT_R_ID,GRID100_PT,INST_R_ID,GRID100_INST,DIST,TIME,SUJIN_POTM_PT_ADDR_CD,SUJIN_POTM_PT_LOC_CD,SUJIN_POTM_INST_ADDR_CD,SUJIN_POTM_INST_LOC_CD,INST_CLSF,DISP_SUBJ_TYPE,MCARE_SUBJ_CD,SICK_SYM1,MDCARE_STRT_DT,FORM_CD,VSHSP_DD_CNT,ED_RC_TOT_AMT,EDC_SBA,EDC_INSUR_BRDN_AMT);
LOAD DATA INFILE "e:\\datafiles\\MCARE_2013.tab" INTO TABLE RAW_MCARE IGNORE 1 LINES (PT_R_ID,GRID100_PT,INST_R_ID,GRID100_INST,DIST,TIME,SUJIN_POTM_PT_ADDR_CD,SUJIN_POTM_PT_LOC_CD,SUJIN_POTM_INST_ADDR_CD,SUJIN_POTM_INST_LOC_CD,INST_CLSF,DISP_SUBJ_TYPE,MCARE_SUBJ_CD,SICK_SYM1,MDCARE_STRT_DT,FORM_CD,VSHSP_DD_CNT,ED_RC_TOT_AMT,EDC_SBA,EDC_INSUR_BRDN_AMT);
LOAD DATA INFILE "e:\\datafiles\\MCARE_2014.tab" INTO TABLE RAW_MCARE IGNORE 1 LINES (PT_R_ID,GRID100_PT,INST_R_ID,GRID100_INST,DIST,TIME,SUJIN_POTM_PT_ADDR_CD,SUJIN_POTM_PT_LOC_CD,SUJIN_POTM_INST_ADDR_CD,SUJIN_POTM_INST_LOC_CD,INST_CLSF,DISP_SUBJ_TYPE,MCARE_SUBJ_CD,SICK_SYM1,MDCARE_STRT_DT,FORM_CD,VSHSP_DD_CNT,ED_RC_TOT_AMT,EDC_SBA,EDC_INSUR_BRDN_AMT);
